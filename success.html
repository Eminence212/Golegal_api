<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <title>Load Form</title>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Creepster&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap');
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }
      .navbar .navbar-text {
        color: rgb(255, 255, 255);
        font-size: 2em;
        /* font-family: Creepster, cursive; */
      }
      h1 {
        font-family: 'IBM Plex Sans Arabic', sans-serif;
        font-size: 2rem;
      }

      .cust-datatable thead {
        background-color: #f9f9f9;
      }
      .cust-datatable > thead > tr > th {
        border-bottom-width: 0;
        color: #443f3f;
        font-size: 0.75rem;
        text-transform: uppercase;
        font-weight: 700;
        padding: 16px 15px;
        vertical-align: middle;
        padding-left: 18px;
      }

      tbody td {
        box-sizing: border-box;
        padding: 10px 15px 10px 18px;
        color: #333232;
        word-wrap: break-word;
        border: 1px solid #eee;
        vertical-align: middle;
        font-size: 0.875rem;
        white-space: nowrap;
      }
      .cust-datatable > tbody tr {
        cursor: pointer;
        border-top: none;
      }
      .cust-datatable > tbody > tr:hover {
        background: #f9f9f9;
      }
      .dataTables_wrapper .dataTables_paginate .paginate_button {
        box-shadow: none;
        padding: 0.25rem 0.7rem !important;
        font-size: 0.875rem !important;
        border-radius: 0.2rem !important;
      }
      .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
        color: #fff !important;
        filter: brightness(1.1) !important;
      }

      .dataTables_wrapper .dataTables_paginate .paginate_button.current,
      .dataTables_wrapper .dataTables_paginate .paginate_button.current:hover {
        border-color: transparent !important;
        filter: brightness(1.1) !important;
        padding: 0.25rem 0.7rem !important;
        font-size: 0.875rem !important;
        border-radius: 0.2rem !important;
      }
      .dataTables_paginate {
        padding-top: 0 !important;
        margin: 15px 10px;
        float: right !important;
      }
      .dataTables_info {
        padding-left: 17px;
        color: #767676 !important;
        font-weight: normal !important;
        float: left;
      }
      tbody tr th,
      tbody tr td {
        border-bottom: 0;
        border: 1px solid #eee;
      }
      .datatables_length,
      .listTables_filter {
        margin: 1rem 0 !important;
      }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-dark bg-dark">
      <div class="container">
        <div class="row">
          <span class="navbar-text"> GOlegal portals </span>
          <div class="col-12"></div>
        </div>
      </div>
    </nav>
    <div class="container">
      <!-- Title -->
      <div class="row pt-5 pb-5">
        <div class="col-12 title">
          <h1>Importation & chargement des données</h1>
        </div>
      </div>
      <!--  SINGLE FILE -->

      <form
        class="row g-3 d-flex align-items-end mb-4"
        action="/api/golegal/uploadfile"
        enctype="multipart/form-data"
        method="POST"
        id="form"
      >
        <div class="col-auto col-md-6">
          <label for="formFileSm" class="form-label fw-light fs-4"
            >Importation</label
          >
          <input
            class="form-control form-control-sm fw-light"
            id="formFileSm"
            type="file"
            name="script"
          />
        </div>
        <div class="col-auto">
          <button
            type="submit"
            class="btn btn-sm bg-dark text-white"
            id="btn-1"
          >
            Charger
          </button>
          <button
            class="btn btn-sm bg-dark text-white d-none"
            type="button"
            disabled
            id="btn-2"
          >
            <span
              class="spinner-border spinner-border-sm"
              role="status"
              aria-hidden="true"
            ></span>
            Chargement...
          </button>
        </div>
      </form>
      <div class="row">
        <div class="col-md-6">
          <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
            <symbol
              id="check-circle-fill"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"
              />
            </symbol>
            <symbol id="info-fill" fill="currentColor" viewBox="0 0 16 16">
              <path
                d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
              />
            </symbol>
            <symbol
              id="exclamation-triangle-fill"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"
              />
            </symbol>
          </svg>
          <div
            class="alert alert-success d-flex align-items-center justify-between"
            style="padding-right: 0"
            role="alert"
          >
            <svg
              class="bi flex-shrink-0 me-2"
              width="24"
              height="24"
              role="img"
              aria-label="Success:"
            >
              <use xlink:href="#check-circle-fill" />
            </svg>
            <div class="d-flex">
              <span class="mx-5 ms-0"
                >Le chargement de données s'est effectué avec succès !
              </span>
              <button
                type="button"
                class="btn-close ms-5 ps-5 float-end"
                data-bs-dismiss="alert"
                aria-label="Close"
                style="position: absolute; right: 0"
                id="btn-1"
              ></button>
              <button
                class="btn btn-sm bg-dark text-white d-none"
                type="button"
                disabled
                id="btn-2"
              >
                <span
                  class="spinner-border spinner-border-sm"
                  role="status"
                  aria-hidden="true"
                ></span>
                Chargement...
              </button>
            </div>
          </div>
        </div>
      </div>
      <div class="row pt-3 pb-3">
        <h2 class="fw-light fs-4">Liste des tables</h2>
        <table
          id="listTables"
          class="table table-striped table-hover cust-datatable dataTable no-footer"
        >
          <thead>
            <tr>
              <th scope="col-auto">#</th>
              <th scope="col-auto">Nom de la table</th>
              <th scope="col-auto">Code</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      jQuery(document).ready(function ($) {
        const liste = document.getElementById('tbody');
        $('#btn-1').removeClass('d-none').addClass('d-block');
        $('#btn-2').removeClass('d-block').addClass('d-none');
        $('#form').on('submit', function (e) {
          $('#btn-1').addClass('d-none').removeClass('d-block');
          $('#btn-2').removeClass('d-none').addClass('d-block');
        });
        //Affichage des tables
        //Row
        function addRow(item, index) {
          const tr = document.createElement('tr');
          const th = document.createElement('th');
          const td1 = document.createElement('td');
          const td2 = document.createElement('td');
          const text1 = document.createTextNode(index + 1);
          const text2 = document.createTextNode(item);
          const text3 = document.createTextNode(
            `ImportJSON("https://golegalapi.herokuapp.com/api/golegal/${item}")`
          );
          th.setAttribute('scope', 'row');
          th.append(text1);
          td1.append(text2);
          td2.append(text3);

          tr.append(th, td1, td2);
          return tr;
        }
        //Fonction afficher tables
        function showTable(items = []) {
          liste.innerHTML = '';

          if (items.length > 0) {
            items.map((item, index) => {
              $('#tbody').append(addRow(item, index));
            });
          }
          $('#listTables').DataTable();
        }

        axios
          .get('https://golegalapi.herokuapp.com/api/golegal')
          .then(({ data }) => {
            showTable(data);
          });
      });
    </script>
  </body>
</html>
